<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø®Ø§ØµÙŠØ© VPN / Ø§Ù„Ù‚ÙØ²Ø© Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ© - PredictIQ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            direction: rtl;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-right: 4px solid #667eea;
        }
        
        .test-section h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
        }
        
        .test-section p {
            color: #555;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 600;
        }
        
        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .results {
            margin-top: 20px;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .result-item {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border-right: 4px solid #667eea;
            background: #f8f9fa;
        }
        
        .result-item.success {
            border-right-color: #28a745;
            background: #d4edda;
        }
        
        .result-item.error {
            border-right-color: #dc3545;
            background: #f8d7da;
        }
        
        .result-item.warning {
            border-right-color: #ffc107;
            background: #fff3cd;
        }
        
        .code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            margin: 10px 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 8px;
        }
        
        .status-indicator.running {
            background: #ffc107;
            animation: pulse 1s infinite;
        }
        
        .status-indicator.success {
            background: #28a745;
        }
        
        .status-indicator.error {
            background: #dc3545;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .info-box {
            background: #e7f3ff;
            border-right: 4px solid #2196F3;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .info-box strong {
            color: #1976D2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø®Ø§ØµÙŠØ© VPN / Ø§Ù„Ù‚ÙØ²Ø© Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©</h1>
        <p class="subtitle">PredictIQ - Geographic Jump Detection Testing Tool</p>
        
        <div class="info-box">
            <strong>ğŸ“Œ Ù…Ù„Ø§Ø­Ø¸Ø©:</strong> Ù‡Ø°Ø§ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± ÙŠØ±Ø³Ù„ events Ù…Ù† Ù…ÙˆØ§Ù‚Ø¹ Ù…Ø®ØªÙ„ÙØ© Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… VPN Ø£Ùˆ ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ© Ø¨Ø³Ø±Ø¹Ø©.
        </div>
        
        <!-- Test Configuration -->
        <div class="test-section">
            <h2>âš™ï¸ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</h2>
            <div class="input-group">
                <label>User ID:</label>
                <input type="text" id="userId" value="user-8456123848" placeholder="user-8456123848">
            </div>
            <div class="input-group">
                <label>Device ID:</label>
                <input type="text" id="deviceId" value="device-demo-01" placeholder="device-demo-01">
            </div>
            <div class="input-group">
                <label>API Base URL:</label>
                <input type="text" id="apiBase" value="http://localhost:5000" placeholder="http://localhost:5000">
            </div>
        </div>
        
        <!-- Quick Test -->
        <div class="test-section">
            <h2>ğŸš€ Ø§Ø®ØªØ¨Ø§Ø± Ø³Ø±ÙŠØ¹ (3 Ù…ÙˆØ§Ù‚Ø¹ Ù…Ø®ØªÙ„ÙØ©)</h2>
            <p>ÙŠØ±Ø³Ù„ 3 events Ù…ØªØªØ§Ù„ÙŠØ© Ù…Ù† Ù…ÙˆØ§Ù‚Ø¹ Ù…Ø®ØªÙ„ÙØ© (Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ Ø¬Ø¯Ø©ØŒ Ø§Ù„Ø¯Ù…Ø§Ù…) Ù„Ù…Ø­Ø§ÙƒØ§Ø© VPN hopping</p>
            <button onclick="runQuickTest()">â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹</button>
        </div>
        
        <!-- Impossible Travel Test -->
        <div class="test-section">
            <h2>âš¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„</h2>
            <p>ÙŠØ±Ø³Ù„ event Ù…Ù† Ø§Ù„Ø±ÙŠØ§Ø¶ Ø«Ù… Ù…Ù† Ø£Ø¨Ù‡Ø§ Ø¨Ø¹Ø¯ 5 Ø¯Ù‚Ø§Ø¦Ù‚ ÙÙ‚Ø· (Ø³Ø±Ø¹Ø© Ù…Ø³ØªØ­ÙŠÙ„Ø© > 900 ÙƒÙ…/Ø³Ø§Ø¹Ø©)</p>
            <button onclick="runImpossibleTravelTest()">â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„</button>
        </div>
        
        <!-- Custom Test -->
        <div class="test-section">
            <h2>ğŸ¯ Ø§Ø®ØªØ¨Ø§Ø± Ù…Ø®ØµØµ</h2>
            <div class="input-group">
                <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø£ÙˆÙ„:</label>
                <select id="location1">
                    <option value="Riyadh">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                    <option value="Jeddah">Ø¬Ø¯Ø©</option>
                    <option value="Dammam">Ø§Ù„Ø¯Ù…Ø§Ù…</option>
                    <option value="Abha">Ø£Ø¨Ù‡Ø§</option>
                    <option value="Mecca">Ù…ÙƒØ©</option>
                    <option value="Medina">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
                </select>
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø«Ø§Ù†ÙŠ:</label>
                <select id="location2">
                    <option value="Jeddah">Ø¬Ø¯Ø©</option>
                    <option value="Riyadh">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                    <option value="Dammam">Ø§Ù„Ø¯Ù…Ø§Ù…</option>
                    <option value="Abha">Ø£Ø¨Ù‡Ø§</option>
                    <option value="Mecca">Ù…ÙƒØ©</option>
                    <option value="Medina">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
                </select>
            </div>
            <div class="input-group">
                <label>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø«Ø§Ù„Ø«:</label>
                <select id="location3">
                    <option value="Dammam">Ø§Ù„Ø¯Ù…Ø§Ù…</option>
                    <option value="Riyadh">Ø§Ù„Ø±ÙŠØ§Ø¶</option>
                    <option value="Jeddah">Ø¬Ø¯Ø©</option>
                    <option value="Abha">Ø£Ø¨Ù‡Ø§</option>
                    <option value="Mecca">Ù…ÙƒØ©</option>
                    <option value="Medina">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</option>
                </select>
            </div>
            <button onclick="runCustomTest()" class="btn-success">â–¶ï¸ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø®ØµØµ</button>
        </div>
        
        <!-- Clear Results -->
        <div class="test-section">
            <h2>ğŸ—‘ï¸ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h2>
            <button onclick="clearResults()" class="btn-danger">Ù…Ø³Ø­ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            <button onclick="checkDashboard()" class="btn-success">ÙØ­Øµ Dashboard</button>
        </div>
        
        <!-- Results -->
        <div class="results" id="results">
            <div class="result-item">
                <strong>ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§...</strong><br>
                <small>Ù‚Ù… Ø¨ØªØ´ØºÙŠÙ„ Ø£ÙŠ Ø§Ø®ØªØ¨Ø§Ø± Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</small>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = window.API_BASE || 'http://localhost:5000';
        
        function getUserId() {
            return document.getElementById('userId').value || 'user-8456123848';
        }
        
        function getDeviceId() {
            return document.getElementById('deviceId').value || 'device-demo-01';
        }
        
        function getApiBase() {
            return document.getElementById('apiBase').value || 'http://localhost:5000';
        }
        
        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const resultItem = document.createElement('div');
            resultItem.className = `result-item ${type}`;
            
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            resultItem.innerHTML = `
                <strong>${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸'} ${message}</strong>
                <br><small>${timestamp}</small>
            `;
            
            results.insertBefore(resultItem, results.firstChild);
        }
        
        async function sendEvent(eventType, location, ip, serviceName = null) {
            const apiBase = getApiBase();
            const userId = getUserId();
            const deviceId = getDeviceId();
            
            const payload = {
                event_type: eventType,
                user_id: userId,
                device_id: deviceId,
                location: location,
                ip_address: ip,
                timestamp1: new Date().toISOString()
            };
            
            if (serviceName) {
                payload.service_name = serviceName;
            }
            
            try {
                const response = await fetch(`${apiBase}/api/v1/event`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    addResult(
                        `Event Ù…Ù† ${location} (${ip}) - Risk Score: ${result.risk_score || 'N/A'}`,
                        result.risk_score >= 80 ? 'warning' : 'success'
                    );
                    
                    if (result.fingerprint_generated) {
                        addResult(`ğŸš¨ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¨ØµÙ…Ø© ØªÙ‡Ø¯ÙŠØ¯! ID: ${result.fingerprint_id}`, 'warning');
                    }
                    
                    return result;
                } else {
                    addResult(`Ø®Ø·Ø£: ${result.message || 'Unknown error'}`, 'error');
                    return null;
                }
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ${error.message}`, 'error');
                return null;
            }
        }
        
        async function runQuickTest() {
            addResult('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹...', 'info');
            
            const locations = ['Riyadh', 'Jeddah', 'Dammam'];
            const ips = ['192.168.1.100', '192.168.1.101', '192.168.1.102'];
            const events = ['login_attempt', 'view_service', 'download_file'];
            const services = [null, 'vehicle_authorization', 'national_id'];
            
            for (let i = 0; i < 3; i++) {
                await sendEvent(events[i], locations[i], ips[i], services[i]);
                if (i < 2) {
                    await new Promise(resolve => setTimeout(resolve, 1500)); // Ø§Ù†ØªØ¸Ø± 1.5 Ø«Ø§Ù†ÙŠØ©
                }
            }
            
            addResult('âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹! ØªØ­Ù‚Ù‚ Ù…Ù† Dashboard', 'success');
        }
        
        async function runImpossibleTravelTest() {
            addResult('âš¡ Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„...', 'info');
            
            // Event 1: Ù…Ù† Ø§Ù„Ø±ÙŠØ§Ø¶ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
            const now = new Date();
            await sendEvent('login_attempt', 'Riyadh', '192.168.1.100');
            
            addResult('â³ Ø§Ù†ØªØ¸Ø§Ø± 2 Ø«Ø§Ù†ÙŠØ© Ù‚Ø¨Ù„ Event Ø§Ù„Ø«Ø§Ù†ÙŠ...', 'info');
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            // Event 2: Ù…Ù† Ø£Ø¨Ù‡Ø§ Ø¨Ø¹Ø¯ 5 Ø¯Ù‚Ø§Ø¦Ù‚ (Ù„ÙƒÙ† ÙÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØªÙŠÙ† ÙÙ‚Ø·)
            // Ø³Ù†Ø³ØªØ®Ø¯Ù… timestamp Ù…Ø®ØªÙ„Ù Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„
            const apiBase = getApiBase();
            const userId = getUserId();
            const deviceId = getDeviceId();
            
            const event2 = {
                event_type: 'download_file',
                user_id: userId,
                device_id: deviceId,
                location: 'Abha',
                ip_address: '192.168.1.101',
                timestamp1: new Date(now.getTime() + 5 * 60 * 1000).toISOString() // 5 Ø¯Ù‚Ø§Ø¦Ù‚ Ø¨Ø¹Ø¯ Event 1
            };
            
            try {
                const response = await fetch(`${apiBase}/api/v1/event`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(event2)
                });
                
                const result = await response.json();
                if (response.ok) {
                    addResult(`Event 2 Ù…Ù† Abha - Risk Score: ${result.risk_score || 'N/A'}`, 'warning');
                }
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£: ${error.message}`, 'error');
            }
            
            addResult('âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„!', 'success');
        }
        
        async function runCustomTest() {
            addResult('ğŸ¯ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø®ØµØµ...', 'info');
            
            const location1 = document.getElementById('location1').value;
            const location2 = document.getElementById('location2').value;
            const location3 = document.getElementById('location3').value;
            
            const locations = [location1, location2, location3];
            const ips = ['192.168.1.200', '192.168.1.201', '192.168.1.202'];
            const events = ['login_attempt', 'view_service', 'download_file'];
            const services = [null, 'vehicle_authorization', 'national_id'];
            
            for (let i = 0; i < 3; i++) {
                await sendEvent(events[i], locations[i], ips[i], services[i]);
                if (i < 2) {
                    await new Promise(resolve => setTimeout(resolve, 1500));
                }
            }
            
            addResult('âœ… Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…Ø®ØµØµ!', 'success');
        }
        
        function clearResults() {
            const results = document.getElementById('results');
            results.innerHTML = '<div class="result-item"><strong>ğŸ“Š Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØªÙ… Ù…Ø³Ø­Ù‡Ø§</strong></div>';
        }
        
        function checkDashboard() {
            const apiBase = getApiBase();
            window.open(`${apiBase}/dashboard.html`, '_blank');
        }
    </script>
</body>
</html>

